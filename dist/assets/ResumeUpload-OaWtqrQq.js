import{c as F,r as c,u as T,j as e,C as I,a as M,b as B,F as x,d as P,B as m,D as A,L as S,T as R,e as b,I as L,f as U,t as l}from"./index-4gjwQ4NU.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=F("ScanText",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 8h8",key:"1jbsf9"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M7 16h6",key:"1vyc9m"}]]),H=({onUploadSuccess:g,onDelete:w,currentResumeUrl:f})=>{const[n,y]=c.useState(null),[h,u]=c.useState(!1),[i,d]=c.useState(null),[j,N]=c.useState(!1),[v,p]=c.useState(null);T(),c.useEffect(()=>{(async()=>{var t;try{const a=localStorage.getItem("token"),o=await fetch("/api/resume/current",{headers:{Authorization:`Bearer ${a}`}});if(o.ok){const r=await o.json();if((t=r==null?void 0:r.data)!=null&&t.resumeUrl){d({url:r.data.resumeUrl,fileName:r.data.fileName||"Resume.pdf",fileSize:r.data.fileSize||0,uploadDate:r.data.uploadDate?new Date(r.data.uploadDate).toISOString():new Date().toISOString()});return}}}catch{}f?d({url:f,fileName:"Resume.pdf",fileSize:0,uploadDate:new Date().toISOString()}):(d(null),p(null))})()},[f]);const k=async s=>{var a,o;const t=(a=s.target.files)==null?void 0:a[0];if(t){const r=t.type==="application/pdf",z=(o=t.name)==null?void 0:o.toLowerCase().endsWith(".pdf");if(!r&&!z){l({title:"Invalid file type",description:"Please upload a PDF file (.pdf)",variant:"destructive"});return}if(t.size>5*1024*1024){l({title:"File too large",description:"Please upload a file smaller than 5MB",variant:"destructive"});return}y(t)}},D=async()=>{if(!n){l({title:"No file selected",description:"Please select a file to upload",variant:"destructive"});return}u(!0);const s=new FormData;s.append("resume",n);try{const t=await fetch("/api/resume/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:s}),a=await t.json();if(!t.ok)throw new Error(a.error||"Failed to upload resume");const o={url:a.data.resumeUrl,fileName:a.data.fileName||n.name,fileSize:a.data.fileSize??n.size,uploadDate:a.data.uploadDate||new Date().toISOString()};d(o),y(null),g&&g(a.data.resumeUrl);try{await fetch("/api/user-profile",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({resume:a.data.resumeUrl})})}catch{}l({title:"Success",description:"Resume uploaded successfully"})}catch(t){console.error("Error:",t),l({title:"Error",description:t instanceof Error?t.message:"Failed to upload resume",variant:"destructive"})}finally{u(!1)}},E=async()=>{if(i)try{u(!0);const s=await fetch("/api/resume/delete",{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok){const t=await s.json();throw new Error(t.message||"Failed to delete resume")}d(null),p(null);try{await fetch("/api/user-profile",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({resume:""})})}catch{}w&&w(),l({title:"Success",description:"Resume deleted successfully"})}catch(s){console.error("Delete error:",s),l({title:"Error",description:s instanceof Error?s.message:"Failed to delete resume",variant:"destructive"})}finally{u(!1)}},C=async()=>{var s;if(!i){l({title:"No resume",description:"Please upload a resume first",variant:"destructive"});return}try{N(!0);const t=await fetch("/api/resume/extract-current",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await t.json();if(!t.ok||!(a!=null&&a.success))throw new Error((a==null?void 0:a.error)||"Failed to extract text");p(a.text||""),l({title:"Extracted",description:`Found ${a.length??(((s=a.text)==null?void 0:s.length)||0)} characters`})}catch(t){console.error("Extract error:",t),l({title:"Error",description:t instanceof Error?t.message:"Failed to extract",variant:"destructive"})}finally{N(!1)}};return e.jsxs(I,{className:"w-full max-w-2xl mx-auto",children:[e.jsx(M,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-6 w-6"}),"Resume Management"]})}),e.jsxs(P,{className:"space-y-6",children:[i&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-medium block",children:i.fileName}),e.jsxs("span",{className:"text-sm text-gray-500",children:[(i.fileSize/1024/1024).toFixed(2)," MB",i.uploadDate&&` • Uploaded ${new Date(i.uploadDate).toLocaleDateString()}`]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>window.open(i.url,"_blank"),children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:C,disabled:j,children:[j?e.jsx(S,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx($,{className:"h-4 w-4 mr-1"}),"Extract Text"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:E,className:"text-red-600 hover:text-red-700",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]}),v!==null&&e.jsxs("div",{className:"mt-4",children:[e.jsx(b,{className:"text-sm font-medium text-gray-700",children:"Extracted Text"}),e.jsx("div",{className:"mt-2 max-h-72 overflow-auto rounded-md border bg-white p-3 text-sm whitespace-pre-wrap",children:v||"—"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{htmlFor:"resume",children:"Upload New Resume (PDF only, max 5MB)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{id:"resume",type:"file",accept:".pdf",onChange:k,disabled:h,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),h&&e.jsx(S,{className:"h-5 w-5 animate-spin"})]}),n&&!h&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(x,{className:"h-4 w-4"}),n.name]}),e.jsxs(m,{size:"sm",onClick:D,className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Upload"]})]})]})]})]})};export{H as default};
